@page "/plants"
@using Core.Dtos
@using Core.Interface.Services
@using Presentation.Components.Cards

@inject NavigationManager NavigationManager
@inject IPlantService Service

<div class="plants-header">
    <div class="plants-header-left">
        <div class="plants-title">Your Plants</div>
        <p class="plants-subtitle">Your whole collection of plants is here!</p>
    </div>

    <div class="plants-header-right">
        <div class="plants-count-pill">@(AllPlants?.Count ?? 0) plants </div>

        <button class="plants-add-btn" type="button" @onclick="GoToAdd">+ Add Plant</button>
    </div>
</div>

@if (AllPlants is null)
{
    <p><em>Loading plants...</em></p>
}
else if (AllPlants?.Count == 0)
{
    <button class="plants-add-btn" type="button" @onclick="GoToAdd">+ Add Plant</button>
}
else
{
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 plants-grid">
        @foreach(var plant in AllPlants)
        {
            <div class="col">
                <PlantCard Plant="plant"
                OnDetails="() => GoToDetails(plant.Id)"
                OnEdit="() => GoToEdit(plant.Id)"
                OnDelete="() => HandleDelete(plant.Id) "></PlantCard>
            </div>
        }
    </div>
}

@code
{
    public List<PlantReadDto> AllPlants { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        AllPlants = await Service.GetAllPlantsAsync(default);
    }

    private void GoToAdd() => NavigationManager.NavigateTo("/plants/add");

    private void GoToDetails(Guid id) => NavigationManager.NavigateTo($"/plants/{id}");

    private void GoToEdit(Guid id) => NavigationManager.NavigateTo($"/plants/edit/{id}");

    private void HandleDelete(Guid id) => Service.DeletePlantAsync(id, default);

}